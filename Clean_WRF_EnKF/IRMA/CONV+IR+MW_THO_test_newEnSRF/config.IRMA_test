# ==== Work Flow Control ====
 RUN_ENKF=true
 RUN_4DVAR=false
 RUN_DETERMINISTIC=true
 RUN_MULTI_PHYS_ENS=false
 RUN_VORTEX_NEST=false
 FOLLOW_STORM=true # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!
 MOVING_NEST=false
 NO_DA=false
 RUN_ENS_FCST=false
 GET_PHYS_FROM_FILE=false
 RESTARTING=false
 CLEAN=false
 USE_PERTS=false

# ==== Experiment Design ====
 EXP_NAME=CONV+IR+MW_THO_test_newEnSRF
 DATE_START=201709021200
 DATE_END=201709080000
 DATE_CYCLE_START=201709030000
 DATE_CYCLE_END=201709030100
 STORM_ID=IRMA

# ==== Directories ===
 WORK_DIR=/scratch/06191/tg854905/Clean_Pro2_PSU_MW/${STORM_ID}/${EXP_NAME}
 SCRIPT_DIR=/work2/06191/tg854905/stampede2/Pro2_PSU_MW/SourceCode/Clean_WRF_EnKF/${STORM_ID}/${EXP_NAME}/
 CODE_DIR=/work2/06191/tg854905/stampede2/JerryZhang_IRMW/Jerry_code/
 DATA_DIR=/work2/06191/tg854905/stampede2/Pro2_PSU_MW/Obs_input_EnKF/${STORM_ID}
 # Tools
 WPS_DIR=${CODE_DIR}/WPS
 WRF_DIR_FCST=${CODE_DIR}/WRFV3_S3
 WRF_PRESET_DIR=${CODE_DIR}/WRF_preset_S3
 WRF_DIR=${WRF_PRESET_DIR} # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!  
 WRFDA_DIR=${CODE_DIR}/WRFDA_S3
 CRTM_DIR=${SCRIPT_DIR}
 CRTM_COEFF_DIR=/work2/06191/tg854905/stampede2/opt/PSU-EnKF_w_satellites/fortran_src/crtm_v2.3.0/coefficients  
 ENKF_DIR=/work2/06191/tg854905/stampede2/opt/PSU-EnKF_w_satellites/fortran_src/EnSRF/src_for_MW # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!! 
 # Input Data
 FG_DIR_GFS=${DATA_DIR}/GFS
 TCVITALS_DIR=${DATA_DIR}/TCvitals
 TCV_DIR=${DATA_DIR}/HPI #location of HPI for assimilation
 GEOG_DIR=/work2/06191/tg854905/stampede2/Pro2_PSU_MW/WPS_GEOG_v3.6.1 
 #PERTS_DIR=$WORK_DIR/robs_perts # Should be used. However, the experiment generates the data itself if it starts from the DATE_START.
 #SO_DIR=$DATA_DIR/superob # Not in use because radar observations are not assimilated.
# === Domain Setup ===
 TWO_WAY_NESTING=true
 MAX_DOM=3
 E_WE=(379 298 298)
 E_SN=(244 298 298)
 E_VERT=(43 43 43)
 DX=(27000 9000 3000)
 DY=(27000 9000 3000)
 TIME_STEP=75 # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!
 # WRF3.6.1: Rob used a time step of 60; Jerry used a time step of 90; Judy spins up with 60 and run other part with 90s
 PARENT_ID=(0 1 2)
 GRID_RATIO=(1 3 3)
 TIME_STEP_RATIO=(1 3 3)
 I_PARENT_START=(1 193 100) #45 101
 J_PARENT_START=(1 73 100) #59 101
 MAP_PROJ="mercator" #mercator only now
 REF_LAT=20.0 # 25.0 
 REF_LON=-55.0 # -65.0
 STAND_LON=-65.0
 TRUELAT1=30.0
 TRUELAT2=60.0
 P_TOP=1000

# === Time Control: (unit=minutes) ===
 CYCLE_PERIOD=(60 60 60 60)
 WRFOUT_INTERVAL=(60 60 60 60)
 LBC_INTERVAL=360
 TCV_INTERVAL=360
 BC_INTERVAL=360
 OBS_WIN_MIN=(-30 -30 -30 -30)
 OBS_WIN_MAX=(30 30 30 30)
 MINUTE_PER_SLOT=(15 15 15 15)
 FORECAST_MINUTES=(60 60 60 60)

# === Physics ===
 MP_PHYSICS=(8 8 8 8) # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!
 RA_LW_PHYSICS=(4 4 4 4)
 RA_SW_PHYSICS=(4 4 4 4)
 RADT=(15 5 3 1)
 SF_SFCLAY_PHYSICS=(1 1 1 1)
 SF_SURFACE_PHYSICS=(1 1 1 1)
 BL_PBL_PHYSICS=(1 1 1 1)
 BLDT=(0 0 0 0)
 CU_PHYSICS=(6 0 0 0)
 CUDT=(0 0 0 0)
 SST_UPDATE=0
 ISFTCFLX=99

# === ENKF Options ===
 NUM_ENS=5  # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!
 NMCPU=1
 NICPU=16
 NJCPU=12
 INFLATION_COEF=1.0 
 RELAXATION_COEF=0.75
# -------------------------------------
# vortex_RTPP
# -------------------------------------
 USE_VORTEX_RTPP=false
 RELAXATION_COEF_CORE=0.75
# -------------------------------------
# Other EnKF filters
# -------------------------------------
 USE_NONLINEAR_ENKF=false
 USE_GMM_ENKF=false
 MAX_KERNEL_NUM=1
 MIN_EXPANDING_KERNEL_PRIOR_SIZE=10
# -------------------------------------
# Replace model fields with other data
# -------------------------------------
 REPLACE_MEAN=false
 REPLACE_MEAN_WITH=gfs
 REPLACE_ENVIRONMENT=true
 RECENTER=false
# -------------------------------------
# Ad-hoc technique for radiance obs
# -------------------------------------
 USE_ESTIMATE_INF=false  
 USE_AOEI_RADIANCE=true     # AOEI for IR
 USE_ELF_RADIANCE=false
 USE_INF_BT_RADIANCE=true  # ABEI for IR
 USE_ESTIMATE_INF_RADIANCE=false

 USE_AOEI_MICROWAVE=true    # AOEI for MW
 USE_ELF_MICROWAVE=false
 USE_INF_BT_MICROWAVE=false # ABEI for MW
 USE_SLANT_PATH=true        # Slant-path calculation for MW


# === Data Sources (used for both EnKF and WRFDA) ===
# -------------------------------------
# Conventional obs  
# -------------------------------------
 conv_frequency=3 # frequency of conventional obs
 INCLUDE_LITTLE_R=true #false
 INCLUDE_BUFR=false
 INCLUDE_MADIS=false
 INCLUDE_AIRBORNE=false
 USE_HURRICANE_PI=false
 # ---------------------
 # in-situ surface obs
 # ---------------------
 USE_SYNOPOBS=true    # in-situ surface/land station “synoptic” report 
 USE_METAROBS=true    # in-situ surface station “meteorological aviation routine weather report” 
 USE_BUOYOBS=true     # in-situ surface report from a drifting buoy
 USE_SURFOBS=true     # surface meteorological observations 
 USE_SHIPSOBS=true    # in-situ surface report from a ship
 # ---------------------------------------
 # non-surface obs: upper-air and profiles
 # ---------------------------------------
 USE_SOUNDOBS=true    # (WMO: TEMP): upper-air temperature, humidity, and wind profiles
 USE_PILOTOBS=true    # (WMO: PILOT/PILOT SHIP/PILOT MOBIL): upper-air wind profiles
 USE_PROFILEROBS=true # ground-based remotely-sensed vertical profiles of wind, temperature, and humidity
 USE_AIREPOBS=true    # in-situ upper-air aircraft report of temperature and wind
 USE_SSMIOBS=true     # remotely-sensed/derived 
 USE_SATEMOBS=true    # remotely-sensed/derived
 USE_GPSPWOBS=false   # remotely-sensed/derived
 USE_GPSREFOBS=true   # remotely-sensed/derived space-based GPS Refractivity
 USE_ATOVS=false      # remotely-sensed/derived
 USE_GEOAMVOBS=true   # remotely-sensed/derived wind observations from GEO satellite
 USE_POLARAMVOBS=true # remotely-sensed/derived wind observations from Polar satellite
 USE_QSCATOBS=true    # scatterometer-derived ocean surface wind observations
# -------------------------------------
# TC-related data (for example, TCVtials)
# -------------------------------------
 INCLUDE_TCV=true
 USE_BOGUSOBS=false
 USE_TCV_winds=false
 USE_hurricane_PI=false
# -------------------------------------
# Radar obs
# -------------------------------------
 INCLUDE_RADAR=false
 USE_RADAROBS=false
 USE_RADAR_RF=false
 USE_RADAR_RV=false
 USE_AIRBORNE_RF=false
 USE_AIRBORNE_RV=false
 USE_COPLANE_UV=false
# -------------------------------------
# Radiance obs
# -------------------------------------
 USE_RADIANCE=true 
 USE_MICROWAVE=true
 MERGE_IRMW_METHOD=ir_mw_removeSomeMWLand
 # Scattering look-up tables for MW calculation
 # Make sure it is consistent with MP scheme!
 CRTM_MP_SCHEME=0 #wsm6(0), gfdlfv3(1), thompson08(2), nssl(3) 
 CRTM_RAINLUT=Thompson08_RainLUT_-109z-1.bin #WSM6_RainLUT_-109z-1.bin
 CRTM_SNOWLUT=Thompson08_SnowLUT_-109z-1.bin #WSM6_SnowLUT_-109z-1.bin
 CRTM_GRAUPELLUT=Thompson08_GraupelLUT_-109z-1.bin #WSM6_GraupelLUT_-109z-1.bin

# === Data Thinning Coefficient === 
 THIN_SURFACE=10
 THIN_SOUNDING=0
 THIN_PROFILER=5
 THIN_AIRCFT=10
 THIN_METAR=10
 THIN_SFCSHP=5
 THIN_SPSSMI=10
 THIN_ATOVS=10
 THIN_SATWND=20
 THIN_GPSPW=0
 THIN_RADAR=5
 THIN_RADIANCE=0
 THIN_MICROWAVE=0

# === Radius of influence (km for HROI, # of layers for VROI) ===
 HROI_HPI=300
 HROI_SFC=900 # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!!
 HROI_UPPER=90 # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!! ????? Maybe use 300 km instead?
 HROI_METAR=45
 HROI_SATWND=45
 HROI_RADAR=45 #with SCL option
 VROI=43
 VROI_RADAR=43
 HROI_RADIANCE=300
 VROI_RADIANCE=999 #74
 VROI_MICROWAVE=999
 USE_VROI_RADIANCE_HALFSFC=false
 USE_VROI_MICROWAVE_HALFSFC=false


# === Data Thinning Coefficient === 
 THIN_SURFACE=10 # !!!!!!!!!!!!! Attention !!!!!!!!!!!!!!!!!! Maybe use 0 instead???
 THIN_SOUNDING=0
 THIN_PROFILER=5
 THIN_AIRCFT=10
 THIN_METAR=10 
 THIN_SFCSHP=5
 THIN_SPSSMI=10
 THIN_ATOVS=10
 THIN_SATWND=20
 THIN_GPSPW=0
 THIN_RADAR=5
 THIN_RADIANCE=0
 THIN_MICROWAVE=0


# === WRFDA Options (For generating perturbation) ===
 CV_OPTIONS=3
 VAR_SCALING1=1.0
 VAR_SCALING2=1.0
 VAR_SCALING3=1.0
 VAR_SCALING4=1.0
 VAR_SCALING5=1.0
 LEN_SCALING1=1.0
 LEN_SCALING2=1.0
 LEN_SCALING3=1.0
 LEN_SCALING4=1.0
 LEN_SCALING5=1.0


# === CPU Usage ====
 HOSTPPN=48  #sbs 48
 HOSTTYPE=Expanse #stampede
 JOB_SUBMIT_MODE=1
 #JOB_SUBMIT_MODE=2
 wrf_1km_ntasks=48
 wrf_ntasks=48 #$HOSTPPN
 #wrf_ntasks=192  # 30 June 2020 resolving CFL error
 wrf_ntasks_fcst=192 #$HOSTPPN
 var3d_ntasks=4 #$HOSTPPN  sbs5130 48
 real_ntasks=4 # sbs 48
 var4d_ntasks=$HOSTPPN
 var4d_ppn=4
 enkf_ntasks=$((NMCPU*$NICPU*$NJCPU)) # 192
 #enkf_ntasts=1
 enkf_ppn=4
 enkf_ppn=1

