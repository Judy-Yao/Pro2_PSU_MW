NETCDF_INC=${TACC_NETCDF_INC}
NETCDF_LIB=${TACC_NETCDF_LIB}
HDF5_LIB=${TACC_HDF5_LIB}

#QN2RE_DIR=/home1/05012/tg843115/src/fv3lut/src
QN2RE_DIR=/work2/06191/tg854905/stampede2/opt/NWP_RTM/MW/qn2re_dev   #/work/02191/yuz31/stampede2/code/CRTM/qn2re

RTTOV123_DIR=/work/05012/tg843115/stampede2/opt/RTTOV/rttov123_single_thread

WGRIB2_DIR=/home1/05012/tg843115/wave/opt/grib2

RTTOV_DIR=${RTTOV123_DIR}

CRTM_DIR=/work/05012/tg843115/stampede2/opt/CRTM/REL-2.3.0_Lu

RTTOV_FCFLAG=-I$(RTTOV_DIR)/include -I$(RTTOV_DIR)/mod
RTTOV_LDFLAG=-L$(RTTOV_DIR)/lib -L$(HDF5_LIB) -lrttov12_wrapper -lrttov12_mw_scatt -lrttov12_brdf_atlas -lrttov12_emis_atlas -lrttov12_other -lrttov12_parallel -lrttov12_coef_io -lrttov12_hdf -lrttov12_main -lhdf5hl_fortran -lhdf5_hl -lhdf5_fortran -lhdf5 


FCFLAG=-f90=ifort  -i4 -w -ftz -align all -fno-alias -fp-model precise -assume realloc_lhs -convert little_endian -traceback -cpp -FR -I$(QN2RE_DIR) -I../ext  -I${WGRIB2_DIR}/lib

#all: test_fv3_restart.mpi paper_scott_2020.mpi paper_mw_scatt.mpi test.exe test_wrf.exe rt_rttov_module.o rt_newxb.o libnewrt.a
all: paper_scott_2020.mpi  rt_rttov_module.o rt_newxb.o libnewrt.a	

libnewrt.a: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o rt_newxb.o rt_zenith_module.o
	ar cr libnewrt.a  rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o rt_newxb.o rt_zenith_module.o

#paper_mw_scatt.mpi: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o paper_mw_scatt.f90
#	mpif90 -o paper_mw_scatt.mpi paper_mw_scatt.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include $(RTTOV_LDFLAG) -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2 

paper_scott_2020.mpi: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o paper_scott_2020.f90
	mpif90 -o paper_scott_2020.mpi paper_scott_2020.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include $(RTTOV_LDFLAG) -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2

#test_fv3_restart.mpi: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o test_fv3_restart.f90
#	mpif90 -o test_fv3_restart.mpi test_fv3_restart.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include $(RTTOV_LDFLAG) -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2 

#test.exe: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o test.f90
#	mpif90 -o test.exe test.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include $(RTTOV_LDFLAG) -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2 

#test_wrf.exe: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_obs_module.o test_wrf.f90
#	mpif90 -o test_wrf.exe test_wrf.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_rttov_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include $(RTTOV_LDFLAG) -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2

rt_newxb.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_result_module.o rt_reff_module.o rt_zenith_module.o rt_newxb.f90 
	mpif90 -c -g $(FCFLAG) -I$(CRTM_DIR)/include rt_newxb.f90 -o rt_newxb.o

rt_crtm_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_result_module.o rt_reff_module.o rt_zenith_module.o rt_crtm_module.f90 
	mpif90 -c -g $(FCFLAG) -I$(CRTM_DIR)/include rt_crtm_module.f90 -o rt_crtm_module.o

rt_result_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_obs_module.o rt_result_module.f90 
	mpif90 -c -g $(FCFLAG) rt_result_module.f90 -o rt_result_module.o

rt_state_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.f90 
	mpif90 -c -g $(FCFLAG) rt_state_module.f90 -o rt_state_module.o

rt_namelist_module.o: rt_namelist_module.f90 rt_constant_module.o 
	mpif90 -c -g $(FCFLAG) rt_namelist_module.f90 -o rt_namelist_module.o

rt_constant_module.o: rt_constant_module.f90
	mpif90 -c -g $(FCFLAG) rt_constant_module.f90 -o rt_constant_module.o

rt_util_module.o: rt_util_module.f90 
	mpif90 -c $(FCFLAG) -I$(NETCDF_INC) rt_util_module.f90 -o rt_util_module.o

rt_rttov_module.o: rt_rttov_module.f90
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_rttov_module.f90 -o rt_rttov_module.o

rt_reff_module.o: rt_reff_module.f90
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_reff_module.f90 -o rt_reff_module.o

rt_zenith_module.o: rt_zenith_module.f90 rt_state_module.o
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_zenith_module.f90 -o rt_zenith_module.o

rt_obs_module.o: rt_obs_module.f90 rt_state_module.o
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_obs_module.f90 -o rt_obs_module.o

clean:
	rm *.o *.mod *.exe *.a *.mpi
