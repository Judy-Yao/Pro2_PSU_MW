NETCDF_INC=/opt/apps/intel24/netcdf/4.9.2/include
NETCDF_LIB=/opt/apps/intel24/netcdf/4.9.2/lib
HDF5_LIB=/opt/apps/intel24/hdf5/1.14.4/lib

QN2RE_DIR=/work2/06191/tg854905/stampede2/opt/NWP_RTM/MW/qn2re_dev

WGRIB2_DIR=/work2/09163/adas2/stampede3/Pro3_MPcsst_CRTM_Abhi/wgrib2-master

#RTTOV_DIR=/work2/06191/tg854905/App/rttov
#${RTTOV123_DIR}

CRTM_DIR=/work2/06191/tg854905/stampede2/JerryZhang_IRMW/Jerry_code/J_PSU-EnKF_w_satellites/fortran_src/crtm_v2.3.0
#/work2/05012/tg843115/stampede2/opt/CRTM/REL-2.3.0_Lu

RTTOV_FCFLAG=-I$(RTTOV_DIR)/include -I$(RTTOV_DIR)/mod
RTTOV_LDFLAG=-L$(RTTOV_DIR)/lib -L$(HDF5_LIB) -lrttov12_wrapper -lrttov12_mw_scatt -lrttov12_brdf_atlas -lrttov12_emis_atlas -lrttov12_other -lrttov12_parallel -lrttov12_coef_io -lrttov12_hdf -lrttov12_main -lhdf5hl_fortran -lhdf5_hl -lhdf5_fortran -lhdf5 


FCFLAG=-f90=ifort  -i4 -w -ftz -align all -fno-alias -fp-model precise -assume realloc_lhs -convert little_endian -traceback -cpp -FR -I$(QN2RE_DIR) -I../ext  -I${WGRIB2_DIR}/lib

#all: test_fv3_restart.mpi paper_scott_2020.mpi paper_mw_scatt.mpi test.exe test_wrf.exe rt_rttov_module.o rt_newxb.o libnewrt.a
all: paper_scott_2020.mpi rt_newxb.o libnewrt.a	

libnewrt.a: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_obs_module.o rt_newxb.o rt_zenith_module.o
	ar cr libnewrt.a  rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_obs_module.o rt_newxb.o rt_zenith_module.o

paper_scott_2020.mpi: rt_constant_module.o rt_util_module.o rt_namelist_module.o rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_obs_module.o paper_scott_2020.f90
	mpif90 -o paper_scott_2020.mpi paper_scott_2020.f90 rt_obs_module.o rt_zenith_module.o  rt_state_module.o rt_reff_module.o rt_result_module.o rt_crtm_module.o rt_util_module.o rt_namelist_module.o rt_constant_module.o -qopenmp -L$(NETCDF_LIB) -lnetcdf -lnetcdff -L$(CRTM_DIR)/lib -lcrtm $(FCFLAG) -I$(CRTM_DIR)/include  -L$(QN2RE_DIR) -lqn2re  -L../ext -lenkf  -L${WGRIB2_DIR}/lib -lwgrib2

rt_newxb.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_result_module.o rt_reff_module.o rt_zenith_module.o rt_newxb.f90 
	mpif90 -c -g $(FCFLAG) -I$(CRTM_DIR)/include rt_newxb.f90 -o rt_newxb.o

rt_crtm_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_result_module.o rt_reff_module.o rt_zenith_module.o rt_crtm_module.f90 
	mpif90 -c -g $(FCFLAG) -I$(CRTM_DIR)/include rt_crtm_module.f90 -o rt_crtm_module.o

rt_result_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.o rt_obs_module.o rt_result_module.f90 
	mpif90 -c -g $(FCFLAG) rt_result_module.f90 -o rt_result_module.o

rt_state_module.o: rt_constant_module.o rt_util_module.o  rt_namelist_module.o rt_util_module.o rt_state_module.f90 
	mpif90 -c -g $(FCFLAG) rt_state_module.f90 -o rt_state_module.o

rt_namelist_module.o: rt_namelist_module.f90 rt_constant_module.o 
	mpif90 -c -g $(FCFLAG) rt_namelist_module.f90 -o rt_namelist_module.o

rt_constant_module.o: rt_constant_module.f90
	mpif90 -c -g $(FCFLAG) rt_constant_module.f90 -o rt_constant_module.o

rt_util_module.o: rt_util_module.f90 
	mpif90 -c $(FCFLAG) -I$(NETCDF_INC) rt_util_module.f90 -o rt_util_module.o

#rt_rttov_module.o: rt_rttov_module.f90
#	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_rttov_module.f90 -o rt_rttov_module.o

rt_reff_module.o: rt_reff_module.f90
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_reff_module.f90 -o rt_reff_module.o

rt_zenith_module.o: rt_zenith_module.f90 rt_state_module.o
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_zenith_module.f90 -o rt_zenith_module.o

rt_obs_module.o: rt_obs_module.f90 rt_state_module.o
	mpif90 -c $(FCFLAG) $(RTTOV_FCFLAG) rt_obs_module.f90 -o rt_obs_module.o

clean:
	rm *.o *.mod *.exe *.a *.mpi
